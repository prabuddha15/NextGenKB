####################  MySQL Command ###########################

#CREATE DATABASE ileague;

DROP TABLE IF EXISTS ileague.VENDOR_DEFECT_MAPPING ;
DROP TRIGGER IF EXISTS ileague.TRG_AUDIT_VENDOR_DEFECT_MAPPING;
DROP TABLE IF EXISTS ileague.AUDIT_VENDOR_DEFECT_MAPPING;

CREATE TABLE ileague.VENDOR_DEFECT_MAPPING (
  VENDOR_LOOKUP_ID VARCHAR(50) NOT NULL,
  DEFECT_CODE VARCHAR(10) NOT NULL,
  STATUS_FLAG VARCHAR(8) NOT NULL,
  ADD_BY_ID VARCHAR(20) NOT NULL,
  ADD_DATE TIMESTAMP NOT NULL,
  PRIMARY KEY (VENDOR_LOOKUP_ID,DEFECT_CODE)
);

CREATE TABLE ileague.AUDIT_VENDOR_DEFECT_MAPPING (
  H_VENDOR_LOOKUP_ID VARCHAR(50) NOT NULL,
  H_DEFECT_CODE VARCHAR(10) NOT NULL,
  H_STATUS_FLAG VARCHAR(8) NOT NULL,
  H_ADD_BY_ID VARCHAR(20) NOT NULL,
  H_ADD_DATE TIMESTAMP NOT NULL,
  AUD_OPERATION VARCHAR(1) NOT NULL,
  PRIMARY KEY (H_VENDOR_LOOKUP_ID,H_DEFECT_CODE)
);


DELIMITER $$
create trigger ileague.TRG_AUDIT_VENDOR_DEFECT_MAPPING
after delete on VENDOR_DEFECT_MAPPING
for each row
BEGIN
INSERT INTO AUDIT_VENDOR_DEFECT_MAPPING
    SET H_VENDOR_LOOKUP_ID = OLD.VENDOR_LOOKUP_ID,
        H_DEFECT_CODE = OLD.DEFECT_CODE,
        H_STATUS_FLAG = OLD.STATUS_FLAG,
        H_ADD_BY_ID = OLD.ADD_BY_ID,
        H_ADD_DATE = NOW(),
        AUD_OPERATION = 'D';
END$$
DELIMITER ;


####################  MySQL Command END ###########################